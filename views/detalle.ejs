<%- include("templates/cabecera", {tituloWeb: 'Detalle de mascota'}) %>

     <div class="container">
          <h1>Detalle Mascota</h1><!-- Se tiene que establecer el metodo para que se aline con el de la ruta router -->
          <% if (error) { %>
               <p>
                    <%= mensaje %>
               </p>
               <a href="/mascotas" class="btn btn-dark btn-block">Volver a Mascotas</a>
          <% } %>
          <!-- En caso que no haya error -->
          <% if (!error) { %>
               <table class="table">
                    <thead>
                      <tr>
                        <th scope="col">#</th>
                        <th scope="col">Nombre</th>
                        <th scope="col">Descripcion</th>
                        <th scope="col">Accion</th>
                      </tr>
                    </thead>
                    <tbody>
                         <tr>
                              <th scope="row"><%= mascota.id %></th>
                              <td><%= mascota.nombre %></td>
                              <td><%= mascota.descripcion %></td>
                              <td><!-- El daa set es un parametro que recibe el id-->
                                   <button class="btn btn-danger btn-sm" id="btnEliminar" data-id="<%= mascota.id %>">
                                        Eliminar
                                   </button>
                              </td>
                         </tr>    
                    </tbody>
                  </table>
          <% } %>
     </div>
     
<%- include("templates/footer") %>


<script>
     const btnEliminar = document.querySelector('#btnEliminar', {
          method: 'delete'
     });

     btnEliminar.addEventListener('click', async() => {
          console.log("Me diste click");
          const id = btnEliminar.dataset.id;
          console.log('id', id)
          try {
               const data = await fetch(`/mascotas/${id}`, {
                   method: 'DELETE' 
               })//fetch es buscar, se busca en esa ubicacion el json para usar sus datos
               const res = await data.json();//el res.estado viene de Mascotas.js en el res.json
               //se extrae dl json el estado, cuando es un if solo es si es true o false
               if (res.estado) {
                    window.location.href = '/mascotas';
               } else {
                    console.log(res)
               }
               console.log(res);
          } catch (error) {
               console.log(error);
          }
     })
</script>